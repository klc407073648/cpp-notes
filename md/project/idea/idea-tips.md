# Idea - 小技巧tips

> 遇到的坑误踩。

# 使用技巧

* 扩展接口，可以在函数后面新增参数，且通过给默认值的方式不影响原来老函数调用
* 变量未付初值，导致for循环异常。 ———— 字符串初始化为"",整数初始化为0
* Linux服务器的sftp磁盘满时，会写入0kb的空文件
* 同质异步发现归并，对于查询相同的内容进行合并查询  ———— 思想就是归并相同的内容或等待积累一定量再定期查询
* 数据库连接池管理
* 流控限制，需要从网关侧统一考虑
* 代码灵活性，多用配置文件读取参数，或者就是从注册中心取
* jsoncpp使用时，采用Json::FastWriter，压缩格式的json内容进行网络传输，传递时用压缩格式的 json 字符串，不包含没有必要的空格和换行符。
* 借助excel里的计算公式，例如将公式的字符串内容写到对应位置，关闭文件后再去读取excel的内容，已经是计算的结果了

* 同步比异步逻辑清晰；但是异步比同步速度快。
    * 协程 ————> 异步的性能，同步的编码方式
    * recv/send操作和epoll_wait在同一个流程，同步操作。
    * recv/send操作和epoll_wait不在同一个流程，异步操作。

* 在真正需要一个存储空间时才去声明变量（分配内存），这样会得到程序在运行时最小的内存花销
* 异步消息: 不能发送地址，不同虚机地址里东西不一样
* C++函数传递参数时，尽量不要多于6个，因为CPU寄存器有6个，大于6个时，程序需要压栈，影响效率！！
* pubsub消息机制，不能确保消息一定被消费
    * 消息先落地，然后异步处理，本地需要有个补偿的job，去处理本地消费失败的消息，这个可以参考push方式消费的过程。
* tcmalloc优化内存使用。  内存碎片化问题解决，减少内核，用户态切换
* Redis做热key缓存，根据QPS看是否要做集群，读写分离，如果是动态热key 。采用客户端，proxy代理redis的方式，让proxy做频率统计。
* 频繁打印io操作影响性能，需要控制printf的输出，利用函数统计来代替打印
* 利用头文件，cmake写自己的.h适配不同版本的头文件包含
* 根据ldd结果，拷贝需要的so文件 + busybox

# 认知

* 项目：**需求分析，设计思想最重要，先构思，再功能。**   ———— 先写入值，从转换从数据库查等
* 学习技术， 理解大于一切

# BUG

* 使用公共库时，如果环境上存在两个同名库，可能引起链接时失败，找不到定义，定位一下原因，是不是搜索库顺序。最好删除其中一个库
* 互斥锁的异常场景释放，可能新增的else if条件判断里异常没有释放锁，**尽量成对使用**