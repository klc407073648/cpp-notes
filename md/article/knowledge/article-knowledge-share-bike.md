# 知识 - 共享单车背后技术

[[toc]]

# 参考资料

* [揭秘共享单车背后的物联网技术](https://zhuanlan.zhihu.com/p/27968477)

# 概述

共享单车作为一种全新的共享经济模式，进入了人们的日常生活，几乎是随处可见。作为低碳环保的绿色出行方式，给人们的出行带来了便利。

![](/_images/article/knowledge/share-bike/共享单车.png)

## 工作原理

下面来介绍共享单车的工作原理，以及它背后所代表的物联网技术应用。

共享单车的技术实现，主要包括这几个主要角色：

* 单车上面的智能锁（这个是核心关键，包括了GPS定位模块，GPRS通讯模块，主控芯片，电控锁模块等）
* 用户手中的手机和APP
* 单车提供商的云服务器（平台）

![](/_images/article/knowledge/share-bike/共享单车角色.png)

1. 单车停放在路边，通过GPS定位模块，定期将定位信息告知给设备商的云服务器 

2. 用户通过手机APP，访问云服务器的数据，查看周边的单车停放位置信息。同时，用户自己的位置信息，也授权APP获取了（不然APP哪知道你在哪）。

3. 用户来到单车旁边，扫单车二维码，APP获取单车ID（就是身份编号），发送开锁信息给云服务器，云服务器发送开锁信息给单车。
   * 这一步是关键步骤，实现也很复杂。因为涉及到用户身份和帐户信息核对（是不是交了押金等），单车信息核对（是不是故障车等）。
   * 如果一切正常，单车通过**GPRS通讯模块**收到解锁命令后，就会由主控模块控制车锁进行解锁。用户也会收到解锁成功的消息，并进入计费状态。

4. 用户开始骑行。过程中，用户通过GPS模块上报云服务器自己的位置信息。其实，到底是用户手机GPS上报，还是单车的GPS上报，还待确定。(用户手机GPS上报，会更加省电)

5. 骑行结束。用户下车，手动拨动车锁，进行锁车。单车检测到锁车成功动作后，发送车已锁好的通知消息给云服务器。云服务器结束计费，发送计费信息和车已锁好的信息给用户APP。用户打开手机APP，可以查看。

![](/_images/article/knowledge/share-bike/共享单车整体过程.png)

整个过程就这么愉快地结束啦！

实际上，看似简单的过程，包括了物联网技术，人联网技术（移动互联网），自动控制技术，GPS全球定位技术等多个技术领域。但是整体的技术实现并不复杂，并没有涉及到什么创新黑科技。

但是，关键的环节在于单车和云服务器之间的通讯，采用的是**老旧的GPRS技术**。为什么要用这种落后的2G技术呢？ 不使用LTE呢？

答案很简单：1 省钱（模块价格低） 2 省电（低功耗） 3 覆盖好

共享单车是**典型的物联网应用场景**，它对网络的要求并不是大数据量（它只需要很少很小的几条消息），而且它不需要速度很快（几秒钟的时延，完全可以忍受），它需要很低的功耗和很长的待机时间。

## 共享单车的发展历程

### 第一代: 机械锁

最初的共享单车版本是采用的机械锁，要使用的话必须手动输入密码才能开锁使用。

这种方式就只需要解决一个问题，就是如何把密码发到使用者的手机上，其实要实现这一点很简单，首先扫描车身上的二维码，在APP得到车辆编码后发回到服务器，服务器再从数据库中找到对应的密码，最后再把密码发回给使用者，然后使用者手动解锁即可。

![](/_images/article/knowledge/share-bike/第一代共享单车.png)

### 第二代: 二维码 + 蓝牙

用户打开共享单车APP时，它会自动与共享单车的蓝牙连接，获取用户的位置信息。然后用户扫描单车二维码，获取单车的ID(唯一编号)，并向云端服务器发送指定单车请求解锁的消息。服务器接收到信号时，会再次进行确认，如果没有问题，就会同意请求，并向指定单车发送开锁指令。

![](/_images/article/knowledge/share-bike/第二代共享单车.png)

### 第三代: 电子密码 + 蓝牙 + GPRS + GPS

智能锁内集成了嵌入式芯片，GPS模块和有独立号码的SIM卡(GRPS数据传输功能)。通过3G、4G网络，与云端保持通信，及时将车辆位置和状态报送云端。

![](/_images/article/knowledge/share-bike/第三代共享单车.png)

::: details
GPRS英文全称为 General packet radio service，中文名称为通用无线分组业务，是一种基于GSM系统的无线分组交换技术，提供端到端的、广域的无线IP连接。相对原来GSM的拨号方式的电路交换数据传送方式，GPRS是分组交换技术，具有“实时在线”“按量计费”“快捷登录”“高速传输”“自如切换”的优点。通俗地讲，GPRS是一项高速数据处理的技术，方法是以“分组”的形式传送资料到用户手上。GPRS是GSM网络向第三代移动通信系统过渡的一项2.5代通信技术，在许多方面都具有显著的优势
:::

### 解锁方式

* 人工解锁 ———— 比较麻烦，需要人工输入密码操作
* 短信解锁 ———— 等待解锁的时间比较久，大约6-10秒
* GPRS解锁 ———— GPRS数据业务，使得单车可以上网发送消息，时延低
* 蓝牙解锁 ———— 需要手动打开蓝牙，依赖蓝牙将指令发送给单车解锁  

## 未来发展

目前，美团、滴滴、哈罗单车三家占据了共享单车市场份额的95%，三家形成了“三足鼎立”的局面。使用真正的物联网技术（例如NB-IoT）来管理单车，因为NB-IoT的特性，非常满足共享单车这样的应用场景。

